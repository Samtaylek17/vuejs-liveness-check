{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?7e02","webpack:///./src/components/Spinner.vue?09a4","webpack:///./src/components/Challenge.vue?49b3","webpack:///./src/App.vue?b218","webpack:///./src/components/Challenge.vue?26b4","webpack:///./src/js/Drawer.ts","webpack:///./src/js/Utils.ts","webpack:///./src/js/RemoteVerifier.ts","webpack:///./src/js/States.ts","webpack:///./src/js/StateManager.ts","webpack:///./src/js/ChallengeProcessor.ts","webpack:///./src/components/Challenge.vue","webpack:///./src/components/Challenge.vue?5486","webpack:///./src/components/Challenge.vue?0c2b","webpack:///./src/components/Spinner.vue?465a","webpack:///./src/components/Spinner.vue","webpack:///./src/components/Spinner.vue?703c","webpack:///./src/components/Spinner.vue?cbee","webpack:///./src/components/Welcome.vue?7391","webpack:///./src/js/RemoteStarter.ts","webpack:///./src/components/Welcome.vue","webpack:///./src/components/Welcome.vue?8d51","webpack:///./src/components/Welcome.vue?6fac","webpack:///./src/components/Result.vue?c584","webpack:///./src/components/Result.vue","webpack:///./src/components/Result.vue?638f","webpack:///./src/components/Result.vue?dcf5","webpack:///./src/components/Error.vue?b373","webpack:///./src/components/Error.vue","webpack:///./src/components/Error.vue?78db","webpack:///./src/components/Error.vue?0f86","webpack:///./src/App.vue","webpack:///./src/App.vue?0ab4","webpack:///./src/App.vue?bff9","webpack:///./src/main.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","attrs","step","mediaStreamReady","on","$event","onChallengeDetails","onError","challengeDetails","onLocalSuccess","onLocalFail","success","onRestart","errorMessage","_e","staticRenderFns","staticClass","style","class","rotate","shouldRotate","videoWidth","videoHeight","domProps","_v","_s","userId","user","token","message","directives","rawName","animation","expression","lottieOptions1","lottieOptions2","canvasElement","drawOptions","faceDrawBoxOptions","faceAreaBox","x","areaLeft","y","areaTop","width","areaWidth","height","areaHeight","drawArea","noseDrawBoxOptions","noseAreaBox","noseLeft","noseTop","noseWidth","noseHeight","box","drawBoxOptions","drawBox","DrawBox","draw","COLOR_RED","COLOR_GREEN","COLOR_YELLOW","envKeys","keys","map","Map","forEach","envKey","replace","Utils","KEY_PREFIX","set","config","fromEntries","configKey","getConfig","trim","toLowerCase","getConfigBooleanValue","useDefaults","setLevel","OFF","Logger","successCallback","errorCallback","constraints","audio","video","parseInt","IMAGE_WIDTH","IMAGE_HEIGHT","facingMode","navigator","mediaDevices","getUserMedia","then","mediaStream","mediaStreamInfo","actualHeight","getVideoTracks","getSettings","actualWidth","info","error","catch","localStorage","getItem","setItem","userDetails","challengeId","videoElement","promises","invisibleCanvas","document","createElement","context","getContext","drawImage","scale","canvas","self","Promise","resolve","reject","toBlob","blob","Error","RemoteVerifier","callFramesApi","parseFloat","IMAGE_JPG_QUALITY","debug","all","requestData","callVerificationApi","verifyEndpoint","API_VERIFY_ENDPOINT_PATTERN","url","API_URL","promise","a","post","response","verifyResponseData","reader","FileReader","readAsDataURL","onloadend","framesEndpoint","API_FRAMES_ENDPOINT_PATTERN","dataUrl","timestamp","Date","now","frameBase64","substr","indexOf","put","_faces","faceBox","addTolerance","tolerance","FACE_AREA_TOLERANCE_PERCENT","nose","FailState","NAME","SuccessState","framesWithoutFace","landmarkIndex","LANDMARK_INDEX","faces","nextState","isFaceBoxInsideFaceArea","detection","isNoseInsideNoseArea","landmarks","positions","STATE_NOSE_MAX_FRAMES_WITHOUT_FACE","boxColor","helpMessage","helpAnimationNumber","STATE_NOSE_DURATION_IN_SECONDS","NoseState","STATE_AREA_MAX_FRAMES_WITHOUT_FACE","STATE_AREA_DURATION_IN_SECONDS","AreaState","undefined","FaceState","changeCurrentState","currentState","getName","endTime","stateOutput","process","end","shouldSaveFrame","state","getMaximumDurationInSeconds","videoElementId","canvasElementId","endCallback","helpMessageCallback","helpAnimatonCallback","stateManager","getElementById","remoteVerifier","id","drawer","srcObject","getMediaStreamInfo","addEventListener","ChallengeProcessor","isProfiling","time","loadFaceDetectionModel","loadLandmarkModel","modelPromises","tinyFaceDetector","load","timeEnd","faceLandmark68Net","challengeProcessor","paused","ended","setTimeout","options","withFaceLandmarks","processDetectionResults","results","dims","resizedResults","stateManagerOutput","drawDetections","drawFaceLandmarks","lastHelpMessage","lastHelpAnimationNumber","uploadFrame","localSuccess","delay","MAX_FPS","extend","components","Lottie","props","details","getUserId","getUserDetails","animationData","help1","help2","cssVars","methods","onLocalEnd","$emit","onHelpMessage","onHelpAnimation","animationNumber","mounted","$nextTick","component","_m","lottieOptions","ready","start","API_START_ENDPOINT","startRequestData","imageWidth","imageHeight","JSON","stringify","Boolean","welcome","loop","loading","startChallenge","title","buttonText","SUCCESS_TITLE","SUCCESS_MESSAGE","SUCCESS_BUTTON","FAIL_TITLE","FAIL_MESSAGE","FAIL_BUTTON","computed","fail","String","loadConfig","configureLogger","Welcome","Challenge","Spinner","Result","verify","loadModels","loadMediaStream","use","render","h","App","$mount","customElement"],"mappings":"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","file":"js/app.cc300355.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Spinner.vue?vue&type=style&index=0&id=4cdecada&scoped=true&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Challenge.vue?vue&type=style&index=0&id=75822c6b&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[(_vm.step === 1)?_c('Welcome',{attrs:{\"ready\":_vm.mediaStreamReady},on:{\"challenge-details\":function($event){return _vm.onChallengeDetails($event)},\"error\":function($event){return _vm.onError($event)}}}):(_vm.step === 2)?_c('Challenge',{attrs:{\"details\":_vm.challengeDetails},on:{\"local-success\":function($event){return _vm.onLocalSuccess($event)},\"local-fail\":function($event){return _vm.onLocalFail()},\"error\":function($event){return _vm.onError($event)}}}):(_vm.step === 3)?_c('Spinner'):(_vm.step === 4)?_c('Result',{attrs:{\"success\":_vm.success},on:{\"restart\":function($event){return _vm.onRestart()}}}):(_vm.step === -1)?_c('Error',{attrs:{\"message\":_vm.errorMessage},on:{\"restart\":function($event){return _vm.onRestart()}}}):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"videoContainer mx-auto\",style:(_vm.cssVars)},[_c('video',{class:{ rotate: _vm.shouldRotate },attrs:{\"id\":\"webcamVideo\",\"width\":_vm.videoWidth,\"height\":_vm.videoHeight,\"autoplay\":\"\",\"muted\":\"\",\"playsinline\":\"\"},domProps:{\"muted\":true}}),_c('canvas',{class:{ rotate: _vm.shouldRotate },attrs:{\"id\":\"overlayCanvas\",\"width\":_vm.videoWidth,\"height\":_vm.videoHeight}}),_c('div',{staticClass:\"helpContainer clearfix\"},[_c('div',{staticClass:\"float-left messageContainer\"},[_c('div',{staticClass:\"message\"},[_c('h5',[_vm._v(\"User Id: \"+_vm._s(_vm.userId))]),_c('h5',{attrs:{\"token\":_vm.user.token}},[_vm._v(\"Token: \"+_vm._s(_vm.user))])])])]),_c('div',{staticClass:\"helpContainer clearfix\"},[_c('div',{staticClass:\"float-left messageContainer\"},[_c('div',{staticClass:\"message\"},[_c('h5',[_vm._v(_vm._s(_vm.message))])])]),_c('div',{staticClass:\"float-right\"},[_c('lottie',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.animation === 1),expression:\"animation === 1\"}],attrs:{\"options\":_vm.lottieOptions1,\"height\":100,\"width\":100}}),_c('lottie',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.animation === 2),expression:\"animation === 2\"}],attrs:{\"options\":_vm.lottieOptions2,\"height\":100,\"width\":100}})],1)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: MIT-0\n\nimport * as faceapi from \"face-api.js\";\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\n\nexport interface DrawBoxOptions {\n  readonly boxColor?: string;\n  readonly lineWidth?: number;\n}\n\nexport interface DrawOptions {\n  readonly faceDrawBoxOptions?: DrawBoxOptions;\n  readonly noseDrawBoxOptions?: DrawBoxOptions;\n}\n\nexport class Drawer {\n  public static COLOR_RED = \"rgba(255, 0, 0, 1)\";\n  public static COLOR_GREEN = \"rgba(0, 255, 0, 1)\";\n  public static COLOR_YELLOW = \"rgba(255, 255, 0, 1)\";\n\n  private readonly challengeDetails: ChallengeDetails;\n  private readonly canvasElement: HTMLCanvasElement;\n\n  constructor(challengeDetails: ChallengeDetails, canvasElement: HTMLCanvasElement) {\n    this.challengeDetails = challengeDetails;\n    this.canvasElement = canvasElement;\n  }\n\n  draw(drawOptions: DrawOptions) {\n    if (drawOptions.faceDrawBoxOptions) {\n      const faceAreaBox = {\n        x: this.challengeDetails.areaLeft,\n        y: this.challengeDetails.areaTop,\n        width: this.challengeDetails.areaWidth,\n        height: this.challengeDetails.areaHeight\n      };\n      this.drawArea(faceAreaBox, drawOptions.faceDrawBoxOptions);\n    }\n    if (drawOptions.noseDrawBoxOptions) {\n      const noseAreaBox = {\n        x: this.challengeDetails.noseLeft,\n        y: this.challengeDetails.noseTop,\n        width: this.challengeDetails.noseWidth,\n        height: this.challengeDetails.noseHeight\n      };\n      this.drawArea(noseAreaBox, drawOptions.noseDrawBoxOptions);\n    }\n  }\n\n  private drawArea(box: faceapi.IRect, drawBoxOptions: DrawBoxOptions) {\n    const drawBox = new faceapi.draw.DrawBox(box, drawBoxOptions);\n    drawBox.draw(this.canvasElement);\n  }\n}\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: MIT-0\n\nimport Logger from \"js-logger\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nexport interface Config {\n  DRAW_DETECTIONS: string;\n  PROFILING: string;\n  API_URL: string;\n  API_START_ENDPOINT: string;\n  API_VERIFY_ENDPOINT_PATTERN: string;\n  API_FRAMES_ENDPOINT_PATTERN: string;\n  IMAGE_WIDTH: string;\n  IMAGE_HEIGHT: string;\n  IMAGE_JPG_QUALITY: string;\n  STATE_AREA_DURATION_IN_SECONDS: string;\n  STATE_NOSE_DURATION_IN_SECONDS: string;\n  STATE_AREA_MAX_FRAMES_WITHOUT_FACE: string;\n  STATE_NOSE_MAX_FRAMES_WITHOUT_FACE: string;\n  MAX_FPS: string;\n  FACE_AREA_TOLERANCE_PERCENT: string;\n  FLIP_VIDEO: string;\n  LANDMARK_INDEX: string;\n}\n\nexport interface MediaStreamInfo {\n  mediaStream: MediaStream;\n  actualHeight: number;\n  actualWidth: number;\n}\n\nexport class Utils {\n  private static KEY_PREFIX = \"VUE_APP_\";\n\n  static loadConfig() {\n    const envKeys = Object.keys(process.env);\n    const map = new Map();\n    envKeys.forEach(function(envKey) {\n      const key = envKey.replace(Utils.KEY_PREFIX, \"\");\n      const value = process.env[envKey] as string;\n      map.set(key, value);\n    });\n    (window as any).config = Object.fromEntries(map);\n  }\n\n  static getConfig(): Config {\n    return (window as any).config as Config;\n  }\n\n  static getConfigBooleanValue(configKey: string): boolean {\n    return (\n      // @ts-ignore\n      Utils.getConfig()\n        [configKey].trim()\n        .toLowerCase() === \"true\"\n    );\n  }\n\n  static isProfiling(): boolean {\n    return Utils.getConfigBooleanValue(\"PROFILING\");\n  }\n\n  static configureLogger() {\n    Logger.useDefaults();\n    if (process.env.NODE_ENV == \"production\") {\n      Logger.setLevel(Logger.OFF);\n    }\n    (window as any).Logger = Logger;\n  }\n\n  static loadMediaStream(successCallback: () => void, errorCallback: (message: string) => void) {\n    const constraints: MediaStreamConstraints = {\n      audio: false,\n      video: {\n        width: parseInt(Utils.getConfig().IMAGE_WIDTH),\n        height: parseInt(Utils.getConfig().IMAGE_HEIGHT),\n        facingMode: \"user\"\n      }\n    };\n    navigator.mediaDevices\n      .getUserMedia(constraints)\n      .then(function(mediaStream: MediaStream) {\n        try {\n          const mediaStreamInfo = {\n            mediaStream: mediaStream,\n            actualHeight: mediaStream.getVideoTracks()[0].getSettings().height,\n            actualWidth: mediaStream.getVideoTracks()[0].getSettings().width\n          };\n          Logger.info(\n            `media info: actualHeight=${mediaStreamInfo.actualHeight} actualWidth=${mediaStreamInfo.actualWidth}`\n          );\n          (window as any).mediaStreamInfo = mediaStreamInfo;\n        } catch (error) {\n          Logger.error(error);\n          errorCallback(\"Error getting video actual sizes\");\n        }\n        successCallback();\n      })\n      .catch(function(error) {\n        Logger.error(error);\n        errorCallback(\"Error getting access to the camera\");\n      });\n  }\n\n  static getMediaStreamInfo(): MediaStreamInfo {\n    return (window as any).mediaStreamInfo as MediaStreamInfo;\n  }\n\n  static getUserId(): string {\n    let userId = window.localStorage.getItem(\"userId\");\n    if (userId === null) {\n      userId = uuidv4();\n      window.localStorage.setItem(\"userId\", userId);\n    }\n    Logger.info(`userId=${userId}`);\n    return userId;\n  }\n\n  static getUserDetails() {\n    const userDetails = window.localStorage.getItem(\"challengeDetails\");\n    Logger.info(`Token=${userDetails}`);\n    return userDetails;\n  }\n}\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: MIT-0\n\nimport axios from \"axios\";\nimport Logger from \"js-logger\";\nimport { Utils } from \"@/js/Utils.ts\";\n\ninterface FramesRequestData {\n  readonly timestamp: number;\n  readonly frameBase64: string;\n  readonly token: string;\n}\n\nexport interface VerifyToken {\n  token: string;\n}\n\ninterface FramesResponseData {\n  readonly message: string;\n}\n\ninterface VerifyRequestData {\n  readonly token: string;\n}\n\ninterface VerifyResponseData {\n  readonly success: boolean;\n}\n\nexport class RemoteVerifier {\n  private readonly challengeId: string;\n  private readonly token: string;\n  private readonly videoElement: HTMLVideoElement;\n  private readonly promises: Promise<any>[];\n  private readonly invisibleCanvas: HTMLCanvasElement;\n\n  constructor(challengeId: string, token: string, videoElement: HTMLVideoElement) {\n    this.challengeId = challengeId;\n    this.token = token;\n    this.videoElement = videoElement;\n    this.promises = [];\n\n    // Create canvas to convert video frames to blob\n    this.invisibleCanvas = document.createElement(\"canvas\");\n    this.invisibleCanvas.width = this.videoElement.width;\n    this.invisibleCanvas.height = this.videoElement.height;\n  }\n\n  uploadFrame() {\n    const context = this.invisibleCanvas.getContext(\"2d\");\n    if (context === null) {\n      throw \"Error getting canvas context\";\n    }\n    context.drawImage(this.videoElement, 0, 0, this.videoElement.width, this.videoElement.height);\n\n    if (Utils.getConfigBooleanValue(\"FLIP_VIDEO\")) {\n      context.scale(-1, 1);\n    }\n\n    const canvas = this.invisibleCanvas;\n    const self = this;\n    this.promises.push(\n      new Promise(function(resolve: () => void, reject: (error: Error) => void) {\n        canvas.toBlob(\n          function(blob) {\n            if (blob === null) {\n              reject(new Error(\"Error creating blob from canvas\"));\n            } else {\n              RemoteVerifier.callFramesApi(self.challengeId, self.token, blob, resolve, reject);\n            }\n          },\n          \"image/jpeg\",\n          parseFloat(Utils.getConfig().IMAGE_JPG_QUALITY)\n        );\n      })\n    );\n  }\n\n  static callFramesApi(\n    challengeId: string,\n    token: string,\n    blob: Blob,\n    resolve: () => void,\n    reject: (error: Error) => void\n  ) {\n    Logger.info(\"uploading frame\");\n    const reader: FileReader = new FileReader();\n    reader.readAsDataURL(blob);\n    reader.onloadend = function() {\n      const framesEndpoint: string = Utils.getConfig().API_FRAMES_ENDPOINT_PATTERN.replace(\n        \"{challengeId}\",\n        challengeId\n      );\n      const url: string = Utils.getConfig().API_URL + framesEndpoint;\n\n      Logger.info(`calling ${url}`);\n      const dataUrl = reader.result as string;\n      const requestData: FramesRequestData = {\n        timestamp: Date.now(),\n        frameBase64: dataUrl.substr(dataUrl.indexOf(\",\") + 1),\n        token: token\n      };\n      Logger.info(requestData);\n      const promise = axios.put(url, requestData);\n      promise\n        .then(function(response: any) {\n          Logger.info(response);\n          const verifyResponseData: FramesResponseData = response.data;\n          Logger.info(verifyResponseData);\n          Logger.info(challengeId);\n          Logger.info(\"frame successfully uploaded\");\n          resolve();\n        })\n        .catch(function(error: any) {\n          Logger.error(error);\n          reject(error);\n        });\n    };\n  }\n\n  verify(successCallback: (result: boolean) => void, errorCallback: (error: Error) => void): void {\n    Logger.debug(this.promises);\n    const self = this;\n    Promise.all(this.promises).then(function() {\n      Logger.info(\"all frames uploaded\");\n      const requestData: VerifyRequestData = {\n        token: self.token\n      };\n      self.callVerificationApi(requestData, successCallback, errorCallback);\n    });\n  }\n\n  private callVerificationApi(\n    requestData: VerifyRequestData,\n    successCallback: (result: boolean) => void,\n    errorCallback: (error: Error) => void\n  ): void {\n    const verifyEndpoint: string = Utils.getConfig().API_VERIFY_ENDPOINT_PATTERN.replace(\n      \"{challengeId}\",\n      this.challengeId\n    );\n    const url: string = Utils.getConfig().API_URL + verifyEndpoint;\n\n    Logger.info(`calling ${url}`);\n    Logger.info(requestData);\n    const promise = axios.post(url, requestData);\n    promise\n      .then(function(response: any) {\n        Logger.info(response);\n        const verifyResponseData: VerifyResponseData = response.data;\n        Logger.info(verifyResponseData);\n        successCallback(verifyResponseData.success);\n      })\n      .catch(function(error: any) {\n        Logger.error(error);\n        errorCallback(error);\n      });\n  }\n\n  // static getUserToken(): VerifyToken {\n  //   return (window as any).VerifyToken\n  // }\n}\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: MIT-0\n\nimport * as faceapi from \"face-api.js\";\nimport Logger from \"js-logger\";\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\nimport { Drawer, DrawOptions } from \"@/js/Drawer.ts\";\nimport { Utils } from \"@/js/Utils.ts\";\n\nexport interface StateOutput {\n  readonly nextState?: State;\n  readonly drawOptions?: DrawOptions;\n  readonly helpMessage?: string;\n  readonly helpAnimationNumber?: number;\n}\n\nexport abstract class State {\n  constructor(readonly challengeDetails: ChallengeDetails) {}\n\n  process(\n    // eslint-disable-next-line\n    _faces: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\n  ): StateOutput {\n    return {};\n  }\n\n  getMaximumDurationInSeconds(): number {\n    return -1;\n  }\n\n  protected isFaceBoxInsideFaceArea(faceBox: faceapi.Box, addTolerance = true) {\n    const tolerance: number = addTolerance ? parseInt(Utils.getConfig().FACE_AREA_TOLERANCE_PERCENT) / 100 : 0;\n    return (\n      faceBox.x >= this.challengeDetails.areaLeft * (1 - tolerance) &&\n      faceBox.y >= this.challengeDetails.areaTop * (1 - tolerance) &&\n      faceBox.x + faceBox.width <= this.challengeDetails.areaLeft + this.challengeDetails.areaWidth * (1 + tolerance) &&\n      faceBox.y + faceBox.height <= this.challengeDetails.areaTop + this.challengeDetails.areaHeight * (1 + tolerance)\n    );\n  }\n\n  protected isNoseInsideNoseArea(nose: faceapi.IPoint) {\n    return (\n      nose.x >= this.challengeDetails.noseLeft &&\n      nose.y >= this.challengeDetails.noseTop &&\n      nose.x <= this.challengeDetails.noseLeft + this.challengeDetails.noseWidth &&\n      nose.y <= this.challengeDetails.noseTop + this.challengeDetails.noseHeight\n    );\n  }\n\n  abstract getName(): string;\n}\n\nexport class FailState extends State {\n  static NAME = \"FailState\";\n\n  getName(): string {\n    return FailState.NAME;\n  }\n}\n\nexport class SuccessState extends State {\n  static NAME = \"SuccessState\";\n\n  getName(): string {\n    return SuccessState.NAME;\n  }\n}\n\nexport class NoseState extends State {\n  static NAME = \"NoseState\";\n\n  private framesWithoutFace = 0;\n  private landmarkIndex = parseInt(Utils.getConfig().LANDMARK_INDEX);\n\n  process(\n    faces: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\n  ): StateOutput {\n    let nextState: State = this;\n    if (faces.length === 1) {\n      if (this.isFaceBoxInsideFaceArea(faces[0].detection.box)) {\n        if (this.isNoseInsideNoseArea(faces[0].landmarks.positions[this.landmarkIndex])) {\n          nextState = new SuccessState(this.challengeDetails);\n        }\n      } else {\n        Logger.info(`NoseState fail: isFaceBoxInsideFaceArea=${this.isFaceBoxInsideFaceArea(faces[0].detection.box)}`);\n        nextState = new FailState(this.challengeDetails);\n      }\n    } else {\n      if (\n        faces.length !== 0 ||\n        ++this.framesWithoutFace > parseInt(Utils.getConfig().STATE_NOSE_MAX_FRAMES_WITHOUT_FACE)\n      ) {\n        Logger.info(`NoseState fail: #faces=${faces.length} framesWithoutFace=${this.framesWithoutFace}`);\n        nextState = new FailState(this.challengeDetails);\n      } else {\n        Logger.debug(`no face detected. Skipping frame...`);\n      }\n    }\n    const drawOptions: DrawOptions = {\n      faceDrawBoxOptions: {\n        boxColor: Drawer.COLOR_GREEN\n      },\n      noseDrawBoxOptions: {\n        boxColor: Drawer.COLOR_YELLOW\n      }\n    };\n    return {\n      nextState: nextState,\n      drawOptions: drawOptions,\n      helpMessage: \"Move the tip of your nose inside the yellow area\",\n      helpAnimationNumber: 2\n    };\n  }\n\n  getMaximumDurationInSeconds(): number {\n    return parseInt(Utils.getConfig().STATE_NOSE_DURATION_IN_SECONDS);\n  }\n\n  getName(): string {\n    return NoseState.NAME;\n  }\n}\n\nexport class AreaState extends State {\n  static NAME = \"AreaState\";\n\n  private framesWithoutFace = 0;\n\n  process(\n    faces: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\n  ): StateOutput {\n    let nextState: State = this;\n    let boxColor = Drawer.COLOR_RED;\n    if (faces.length === 1) {\n      if (this.isFaceBoxInsideFaceArea(faces[0].detection.box, false)) {\n        boxColor = Drawer.COLOR_GREEN;\n        nextState = new NoseState(this.challengeDetails);\n      }\n    } else {\n      if (\n        faces.length !== 0 ||\n        ++this.framesWithoutFace > parseInt(Utils.getConfig().STATE_AREA_MAX_FRAMES_WITHOUT_FACE)\n      ) {\n        Logger.info(`AreaState fail: #faces=${faces.length} framesWithoutFace=${this.framesWithoutFace}`);\n        nextState = new FailState(this.challengeDetails);\n      } else {\n        Logger.debug(`no face detected. Skipping frame...`);\n      }\n    }\n    const drawOptions: DrawOptions = {\n      faceDrawBoxOptions: {\n        boxColor: boxColor\n      }\n    };\n    return {\n      nextState: nextState,\n      drawOptions: drawOptions,\n      helpMessage: \"Center your face inside the area\",\n      helpAnimationNumber: 1\n    };\n  }\n\n  getMaximumDurationInSeconds(): number {\n    return parseInt(Utils.getConfig().STATE_AREA_DURATION_IN_SECONDS);\n  }\n\n  getName(): string {\n    return AreaState.NAME;\n  }\n}\n\nexport class FaceState extends State {\n  static NAME = \"FaceState\";\n\n  process(\n    faces: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\n  ): StateOutput {\n    let nextState: State = this;\n    let helpMessage = undefined;\n    switch (faces.length) {\n      case 0:\n        helpMessage = \"No face detected. Look at the camera.\";\n        break;\n      case 1:\n        nextState = new AreaState(this.challengeDetails);\n        break;\n      default:\n        helpMessage = \"More than one face detected. Should be one.\";\n    }\n    const drawOptions: DrawOptions = {\n      faceDrawBoxOptions: {\n        boxColor: Drawer.COLOR_RED\n      }\n    };\n    return {\n      nextState: nextState,\n      drawOptions: drawOptions,\n      helpMessage: helpMessage\n    };\n  }\n\n  getName(): string {\n    return FaceState.NAME;\n  }\n}\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: MIT-0\n\nimport * as faceapi from \"face-api.js\";\nimport Logger from \"js-logger\";\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\nimport { DrawOptions } from \"@/js/Drawer.ts\";\nimport { FaceState } from \"@/js/States.ts\";\nimport { FailState } from \"@/js/States.ts\";\nimport { NoseState } from \"@/js/States.ts\";\nimport { State } from \"@/js/States.ts\";\nimport { StateOutput } from \"@/js/States.ts\";\nimport { SuccessState } from \"@/js/States.ts\";\n\nexport interface StateManagerOutput {\n  readonly end: boolean;\n  readonly success?: boolean;\n  readonly shouldSaveFrame: boolean;\n  readonly drawOptions?: DrawOptions;\n  readonly helpMessage?: string;\n  readonly helpAnimationNumber?: number;\n}\n\nexport class StateManager {\n  private readonly challengeDetails: ChallengeDetails;\n\n  private currentState!: State;\n  private endTime!: number;\n\n  constructor(challengeDetails: ChallengeDetails) {\n    this.challengeDetails = challengeDetails;\n    this.changeCurrentState(new FaceState(this.challengeDetails));\n  }\n\n  process(\n    result: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\n  ): StateManagerOutput {\n    Logger.debug(`current state: ${this.currentState.getName()}`);\n\n    if (this.endTime > 0 && Date.now() / 1000 > this.endTime) {\n      Logger.info(`fail: state timed out`);\n      this.changeCurrentState(new FailState(this.challengeDetails));\n    }\n    const stateOutput: StateOutput = this.currentState.process(result);\n    if (stateOutput.nextState) {\n      this.changeCurrentState(stateOutput.nextState);\n    }\n\n    let end = false;\n    let shouldSaveFrame = false;\n    let success;\n    if (this.currentState.getName() === SuccessState.NAME) {\n      end = true;\n      success = true;\n      shouldSaveFrame = true;\n    } else if (this.currentState.getName() === FailState.NAME) {\n      end = true;\n      success = false;\n    } else if (this.currentState.getName() === NoseState.NAME) {\n      shouldSaveFrame = true;\n    }\n    return {\n      end: end,\n      success: success,\n      shouldSaveFrame: shouldSaveFrame,\n      drawOptions: stateOutput.drawOptions,\n      helpMessage: stateOutput.helpMessage,\n      helpAnimationNumber: stateOutput.helpAnimationNumber\n    };\n  }\n\n  private changeCurrentState(state: State) {\n    if (this.currentState !== state) {\n      this.currentState = state;\n      this.endTime =\n        state.getMaximumDurationInSeconds() != -1 ? Date.now() / 1000 + state.getMaximumDurationInSeconds() : -1;\n    }\n  }\n}\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: MIT-0\n\nimport * as faceapi from \"face-api.js\";\nimport Logger from \"js-logger\";\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\nimport { Drawer } from \"@/js/Drawer.ts\";\nimport { RemoteVerifier } from \"@/js/RemoteVerifier.ts\";\nimport { StateManager } from \"@/js/StateManager.ts\";\nimport { StateManagerOutput } from \"@/js/StateManager.ts\";\nimport { Utils } from \"@/js/Utils.ts\";\n\nexport class ChallengeProcessor {\n  private readonly endCallback: (success: boolean, remoteVerifier: RemoteVerifier | undefined) => void;\n  private readonly helpMessageCallback: (helpMessage: string | undefined) => void;\n  private readonly helpAnimatonCallback: (helpAnimationNumber: number | undefined) => void;\n  private readonly drawer: Drawer;\n  private readonly stateManager: StateManager;\n  private readonly videoElement: HTMLVideoElement;\n  private readonly canvasElement: HTMLCanvasElement;\n  private readonly remoteVerifier: RemoteVerifier;\n\n  private lastHelpMessage: string | undefined;\n  private lastHelpAnimationNumber: number | undefined;\n\n  constructor(\n    challengeDetails: ChallengeDetails,\n    videoElementId: string,\n    canvasElementId: string,\n    endCallback: (result: boolean) => void,\n    helpMessageCallback: (helpMessage: string | undefined) => void,\n    helpAnimatonCallback: (helpAnimationNumber: number | undefined) => void\n  ) {\n    this.endCallback = endCallback;\n    this.helpMessageCallback = helpMessageCallback;\n    this.helpAnimatonCallback = helpAnimatonCallback;\n    this.stateManager = new StateManager(challengeDetails);\n    this.videoElement = document.getElementById(videoElementId) as HTMLVideoElement;\n    if (!this.videoElement) {\n      throw \"Video element not found\";\n    }\n    this.remoteVerifier = new RemoteVerifier(challengeDetails.id, challengeDetails.token, this.videoElement);\n\n    this.canvasElement = document.getElementById(canvasElementId) as HTMLCanvasElement;\n    if (!this.canvasElement) {\n      throw \"Canvas element not found\";\n    }\n    this.drawer = new Drawer(challengeDetails, this.canvasElement);\n\n    this.videoElement.srcObject = Utils.getMediaStreamInfo().mediaStream;\n\n    const self = this;\n    self.videoElement.addEventListener(\"loadedmetadata\", function() {\n      ChallengeProcessor.process(self);\n    });\n  }\n\n  static loadModels() {\n    if (Utils.isProfiling()) {\n      Logger.time(\"faceDetectionModelLoad\");\n      Logger.time(\"faceLandmarkModelLoad\");\n    }\n    const promises: Promise<void>[] = [];\n    const url = \"/weights/\";\n    promises.push(this.loadFaceDetectionModel(url));\n    promises.push(this.loadLandmarkModel(url));\n    (window as any).modelPromises = promises;\n  }\n\n  private static loadFaceDetectionModel(url: string): Promise<void> {\n    const promise = faceapi.nets.tinyFaceDetector.load(url);\n    promise.then(function() {\n      if (Utils.isProfiling()) {\n        Logger.timeEnd(\"faceDetectionModelLoad\");\n      }\n      Logger.info(\"tinyFaceDetector model loaded\");\n    });\n    return promise;\n  }\n\n  private static loadLandmarkModel(url: string): Promise<void> {\n    const promise = faceapi.nets.faceLandmark68Net.load(url);\n    promise.then(function() {\n      if (Utils.isProfiling()) {\n        Logger.timeEnd(\"faceLandmarkModelLoad\");\n      }\n      Logger.info(\"faceLandmark68Net model loaded\");\n    });\n    return promise;\n  }\n\n  static process(challengeProcessor: ChallengeProcessor): any {\n    Logger.debug(\"video event handler\");\n    if (challengeProcessor.videoElement.paused || challengeProcessor.videoElement.ended) {\n      Logger.debug(\"video paused or ended\");\n      return setTimeout(() => ChallengeProcessor.process(challengeProcessor), 15);\n    }\n\n    if (Utils.isProfiling()) {\n      Logger.time(\"faceDetectionWithFaceLandmarks\");\n    }\n    const options = new faceapi.TinyFaceDetectorOptions();\n    faceapi\n      .detectAllFaces(challengeProcessor.videoElement, options)\n      .withFaceLandmarks(false)\n      .then(\n        // @ts-ignore\n        function(result: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]) {\n          if (Utils.isProfiling()) {\n            Logger.timeEnd(\"faceDetectionWithFaceLandmarks\");\n          }\n\n          if (result) {\n            ChallengeProcessor.processDetectionResults(challengeProcessor, result);\n          } else {\n            setTimeout(() => ChallengeProcessor.process(challengeProcessor));\n          }\n        }\n      );\n  }\n\n  static processDetectionResults(\n    challengeProcessor: ChallengeProcessor,\n    results: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\n  ) {\n    const dims = faceapi.matchDimensions(challengeProcessor.canvasElement, challengeProcessor.videoElement);\n    const resizedResults = faceapi.resizeResults(results, dims);\n    const stateManagerOutput: StateManagerOutput = challengeProcessor.stateManager.process(results);\n\n    if (Utils.getConfigBooleanValue(\"DRAW_DETECTIONS\")) {\n      faceapi.draw.drawDetections(challengeProcessor.canvasElement, resizedResults);\n      faceapi.draw.drawFaceLandmarks(challengeProcessor.canvasElement, resizedResults);\n    }\n\n    if (stateManagerOutput.drawOptions) {\n      challengeProcessor.drawer.draw(stateManagerOutput.drawOptions);\n    }\n\n    if (stateManagerOutput.helpMessage !== challengeProcessor.lastHelpMessage) {\n      Logger.debug(\n        `help message change: from='${challengeProcessor.lastHelpMessage}' to='${stateManagerOutput.helpMessage}'`\n      );\n      challengeProcessor.helpMessageCallback(stateManagerOutput.helpMessage);\n    }\n    challengeProcessor.lastHelpMessage = stateManagerOutput.helpMessage;\n\n    if (stateManagerOutput.helpAnimationNumber !== challengeProcessor.lastHelpAnimationNumber) {\n      Logger.debug(\n        `help animation change: from=${challengeProcessor.lastHelpAnimationNumber} to=${stateManagerOutput.helpAnimationNumber}`\n      );\n      challengeProcessor.helpAnimatonCallback(stateManagerOutput.helpAnimationNumber);\n    }\n    challengeProcessor.lastHelpAnimationNumber = stateManagerOutput.helpAnimationNumber;\n\n    if (stateManagerOutput.shouldSaveFrame) {\n      Logger.debug(\"should save frame\");\n      challengeProcessor.remoteVerifier.uploadFrame();\n    }\n\n    if (stateManagerOutput.end) {\n      const localSuccess = stateManagerOutput.success as boolean;\n      if (localSuccess) {\n        Logger.info(\"challenge successfully completed locally\");\n      } else {\n        Logger.info(\"challenge failed locally\");\n      }\n\n      // if successfully completed locally, pass along remoteVerifier to callback for remote verification\n      challengeProcessor.endCallback(localSuccess, localSuccess ? challengeProcessor.remoteVerifier : undefined);\n    } else {\n      const delay = 10000 / parseInt(Utils.getConfig().MAX_FPS);\n      setTimeout(() => ChallengeProcessor.process(challengeProcessor), delay);\n    }\n  }\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from \"vue\";\nimport Lottie from \"vue-lottie\";\nimport * as help1 from \"@/assets/lottie/help1.json\";\nimport * as help2 from \"@/assets/lottie/help2.json\";\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\nimport { ChallengeProcessor } from \"@/js/ChallengeProcessor.ts\";\nimport { RemoteVerifier } from \"@/js/RemoteVerifier.ts\";\nimport { Utils } from \"@/js/Utils.ts\";\n\nexport default Vue.extend({\n  name: \"Challenge\",\n  components: {\n    Lottie\n  },\n  props: {\n    details: Object\n  },\n  data() {\n    return {\n      userId: Utils.getUserId(),\n      message: \"Loading...\",\n      user: Utils.getUserDetails(),\n      animation: -1,\n      // @ts-ignore\n      lottieOptions1: { animationData: help1.default },\n      // @ts-ignore\n      lottieOptions2: { animationData: help2.default },\n\n      videoWidth: Utils.getMediaStreamInfo().actualWidth,\n      videoHeight: Utils.getMediaStreamInfo().actualHeight,\n      shouldRotate: Utils.getConfigBooleanValue(\"FLIP_VIDEO\"),\n      // Ugly hack to pass variables to CSS\n      cssVars: {\n        \"--video-width\": Utils.getMediaStreamInfo().actualWidth + \"px\",\n        \"--video-height\": Utils.getMediaStreamInfo().actualHeight + \"px\",\n        \"--help-container-padding-top\": Utils.getMediaStreamInfo().actualHeight + 5 + \"px\"\n      }\n    };\n  },\n  methods: {\n    onLocalEnd(success: boolean, remoteVerifier: RemoteVerifier | undefined): void {\n      if (success) {\n        this.$emit(\"local-success\", remoteVerifier as RemoteVerifier);\n      } else {\n        this.$emit(\"local-fail\");\n      }\n    },\n    onHelpMessage(message: string | undefined): void {\n      this.message = message || \"\";\n    },\n    onHelpAnimation(animationNumber: number | undefined): void {\n      this.animation = animationNumber || -1;\n    }\n  },\n  mounted: function() {\n    const self: any = this;\n    this.$nextTick(function() {\n      new ChallengeProcessor(\n        self.details as ChallengeDetails,\n        \"webcamVideo\",\n        \"overlayCanvas\",\n        self.onLocalEnd,\n        self.onHelpMessage,\n        self.onHelpAnimation\n      );\n    });\n  }\n});\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Challenge.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Challenge.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Challenge.vue?vue&type=template&id=75822c6b&scoped=true&\"\nimport script from \"./Challenge.vue?vue&type=script&lang=ts&\"\nexport * from \"./Challenge.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Challenge.vue?vue&type=style&index=0&id=75822c6b&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"75822c6b\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"text-center mt-5\"},[_c('div',{staticClass:\"spinner-border big-spinner\",attrs:{\"role\":\"status\"}}),_c('h2',{staticClass:\"mt-5\"},[_vm._v(\"Processing...\")])])}]\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from \"vue\";\n\nexport default Vue.extend({\n  name: \"Spinner\"\n});\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Spinner.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Spinner.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Spinner.vue?vue&type=template&id=4cdecada&scoped=true&\"\nimport script from \"./Spinner.vue?vue&type=script&lang=ts&\"\nexport * from \"./Spinner.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Spinner.vue?vue&type=style&index=0&id=4cdecada&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4cdecada\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"text-center\"},[_c('lottie',{attrs:{\"options\":_vm.lottieOptions,\"height\":300,\"width\":300}}),_vm._m(0),(_vm.loading)?_c('div',{staticClass:\"spinner-border mt-5\",attrs:{\"role\":\"status\"}}):_c('button',{staticClass:\"btn btn-primary btn-lg mt-5\",attrs:{\"type\":\"button\",\"disabled\":!_vm.ready},on:{\"click\":function($event){return _vm.start()}}},[_vm._v(\" Verify now! \")])],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h4',{staticClass:\"display-4 mt-4\"},[_c('strong',[_vm._v(\"Liveness\")]),_vm._v(\" Detection\")])}]\n\nexport { render, staticRenderFns }","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: MIT-0\n\nimport axios from \"axios\";\nimport Logger from \"js-logger\";\nimport { Utils } from \"@/js/Utils.ts\";\n\ninterface StartRequestData {\n  readonly userId: string;\n  readonly imageWidth: number;\n  readonly imageHeight: number;\n}\n\nexport interface ChallengeDetails {\n  id: string;\n  userId: string;\n  token: string;\n  areaHeight: number;\n  areaLeft: number;\n  areaTop: number;\n  areaWidth: number;\n  imageHeight: number;\n  imageWidth: number;\n  noseHeight: number;\n  noseLeft: number;\n  noseTop: number;\n  noseWidth: number;\n}\n\nexport class RemoteStarter {\n  static startChallenge(\n    successCallback: (challengeDetails: ChallengeDetails) => void,\n    errorCallback: (error: Error) => void\n  ): void {\n    const url: string = Utils.getConfig().API_URL + Utils.getConfig().API_START_ENDPOINT;\n    const startRequestData: StartRequestData = {\n      userId: Utils.getUserId(),\n      imageWidth: Utils.getMediaStreamInfo().actualWidth,\n      imageHeight: Utils.getMediaStreamInfo().actualHeight\n    };\n    Logger.info(`calling ${url}`);\n    Logger.info(startRequestData);\n    axios\n      .post(url, startRequestData)\n      .then(function(response: any) {\n        Logger.info(response);\n        const challengeDetails: ChallengeDetails = response.data;\n        const userDetails = JSON.stringify(response.data.token);\n        window.localStorage.setItem(\"challengeDetails\", userDetails);\n        Logger.info(challengeDetails);\n        successCallback(challengeDetails);\n      })\n      .catch(function(error: any) {\n        Logger.error(error);\n        errorCallback(error);\n      });\n  }\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from \"vue\";\nimport Lottie from \"vue-lottie\";\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\nimport { RemoteStarter } from \"@/js/RemoteStarter.ts\";\nimport * as welcomeData from \"@/assets/lottie/welcome.json\";\n\nexport default Vue.extend({\n  name: \"Welcome\",\n  components: {\n    Lottie\n  },\n  props: {\n    ready: Boolean\n  },\n  data() {\n    return {\n      lottieOptions: {\n        // @ts-ignore\n        animationData: welcomeData.default,\n        loop: false\n      },\n      loading: false\n    };\n  },\n  methods: {\n    start(): void {\n      this.loading = true;\n      const self: any = this;\n      RemoteStarter.startChallenge(\n        function(challengeDetails: ChallengeDetails) {\n          // Make sure all models are loaded\n          Promise.all((window as any).modelPromises).then(function() {\n            self.$emit(\"challenge-details\", challengeDetails);\n          });\n        },\n        function(error: Error) {\n          self.$emit(\"error\", error);\n        }\n      );\n    }\n  }\n});\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Welcome.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Welcome.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Welcome.vue?vue&type=template&id=07ed8802&scoped=true&\"\nimport script from \"./Welcome.vue?vue&type=script&lang=ts&\"\nexport * from \"./Welcome.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"07ed8802\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"text-center\"},[_c('lottie',{attrs:{\"options\":_vm.lottieOptions,\"height\":200,\"width\":200}}),_c('h2',{staticClass:\"mt-4\"},[_vm._v(_vm._s(_vm.title))]),_c('h3',{staticClass:\"mt-2\"},[_c('small',{staticClass:\"text-muted\"},[_vm._v(_vm._s(_vm.message))])]),_c('button',{staticClass:\"btn btn-primary btn-lg mt-5\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){return _vm.$emit('restart')}}},[_vm._v(_vm._s(_vm.buttonText))])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from \"vue\";\nimport Lottie from \"vue-lottie\";\nimport * as successData from \"@/assets/lottie/success.json\";\nimport * as failData from \"@/assets/lottie/fail.json\";\n\nconst SUCCESS_TITLE = \"Verified!\";\nconst SUCCESS_MESSAGE = \"Successfully verified as a live person.\";\nconst SUCCESS_BUTTON = \"Start over\";\nconst FAIL_TITLE = \"Uh-oh.\";\nconst FAIL_MESSAGE = \"We could not detect a live person.\";\nconst FAIL_BUTTON = \"Try again\";\n\nexport default Vue.extend({\n  name: \"Result\",\n  components: {\n    Lottie\n  },\n  props: {\n    success: Boolean\n  },\n  computed: {\n    title(): string {\n      return this.success ? SUCCESS_TITLE : FAIL_TITLE;\n    },\n    message(): string {\n      return this.success ? SUCCESS_MESSAGE : FAIL_MESSAGE;\n    },\n    buttonText(): string {\n      return this.success ? SUCCESS_BUTTON : FAIL_BUTTON;\n    },\n    lottieOptions(): any {\n      return {\n        // @ts-ignore\n        animationData: this.success ? successData.default : failData.default,\n        loop: false\n      };\n    }\n  }\n});\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Result.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Result.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Result.vue?vue&type=template&id=b7e669d0&\"\nimport script from \"./Result.vue?vue&type=script&lang=ts&\"\nexport * from \"./Result.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"text-center\"},[_c('svg',{staticClass:\"bi bi-emoji-frown\",attrs:{\"width\":\"150px\",\"height\":\"150px\",\"viewBox\":\"0 0 16 16\",\"fill\":\"currentColor\",\"xmlns\":\"http://www.w3.org/2000/svg\"}},[_c('path',{attrs:{\"fill-rule\":\"evenodd\",\"d\":\"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z\"}}),_c('path',{attrs:{\"fill-rule\":\"evenodd\",\"d\":\"M4.285 12.433a.5.5 0 0 0 .683-.183A3.498 3.498 0 0 1 8 10.5c1.295 0 2.426.703 3.032 1.75a.5.5 0 0 0 .866-.5A4.498 4.498 0 0 0 8 9.5a4.5 4.5 0 0 0-3.898 2.25.5.5 0 0 0 .183.683z\"}}),_c('path',{attrs:{\"d\":\"M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z\"}})]),_c('h2',{staticClass:\"mt-4\"},[_vm._v(\"Something went wrong\")]),_c('h3',{staticClass:\"mt-2\"},[_c('small',{staticClass:\"text-muted\"},[_vm._v(_vm._s(_vm.message))])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from \"vue\";\n\nexport default Vue.extend({\n  name: \"Error\",\n  props: {\n    message: String\n  }\n});\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Error.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Error.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Error.vue?vue&type=template&id=3b94e560&\"\nimport script from \"./Error.vue?vue&type=script&lang=ts&\"\nexport * from \"./Error.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from \"vue\";\nimport Challenge from \"./components/Challenge.vue\";\nimport Spinner from \"./components/Spinner.vue\";\nimport Welcome from \"./components/Welcome.vue\";\nimport Result from \"./components/Result.vue\";\nimport Error from \"./components/Error.vue\";\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\nimport { ChallengeProcessor } from \"@/js/ChallengeProcessor.ts\";\nimport { RemoteVerifier } from \"@/js/RemoteVerifier.ts\";\nimport { Utils } from \"@/js/Utils.ts\";\n\nUtils.loadConfig();\nUtils.configureLogger();\n\nexport default Vue.extend({\n  name: \"App\",\n  components: {\n    Welcome,\n    Challenge,\n    Spinner,\n    Result,\n    Error\n  },\n  data() {\n    return {\n      challengeDetails: {},\n      success: false,\n      step: 1,\n      mediaStreamReady: false,\n      errorMessage: \"\"\n    };\n  },\n  methods: {\n    onChallengeDetails(challengeDetails: ChallengeDetails): void {\n      this.challengeDetails = challengeDetails;\n      this.step = 2;\n    },\n    onLocalSuccess(remoteVerifier: RemoteVerifier): void {\n      this.step = 3;\n\n      const self = this;\n      remoteVerifier.verify(\n        function(success: boolean) {\n          self.success = success;\n          self.step = 4;\n        },\n        function(error: Error) {\n          self.onError(error);\n        }\n      );\n    },\n    onLocalFail(): void {\n      this.success = false;\n      this.step = 4;\n    },\n    onRestart(): void {\n      this.step = 1;\n    },\n    onError(error: Error): void {\n      this.errorMessage = error.name + \": \" + error.message;\n      this.step = -1;\n    }\n  },\n  mounted: function() {\n    ChallengeProcessor.loadModels();\n\n    const self = this;\n    Utils.loadMediaStream(\n      function() {\n        self.mediaStreamReady = true;\n      },\n      function(message) {\n        self.errorMessage = message;\n        self.step = -1;\n      }\n    );\n  }\n});\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--14-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/ts-loader/index.js??ref--14-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--14-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/ts-loader/index.js??ref--14-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=af3b4878&\"\nimport script from \"./App.vue?vue&type=script&lang=ts&\"\nexport * from \"./App.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: MIT-0\n\nimport Vue from \"vue\";\nimport App from \"./App.vue\";\nimport vueCustomElement from \"vue-custom-element\";\nimport \"document-register-element/build/document-register-element\";\n\nVue.use(vueCustomElement);\n// Vue.config.productionTip = false;\n\nnew Vue({\n  render: h => h(App)\n}).$mount(\"#app\");\n\nVue.customElement(\"vue-widget\", App);\n"],"sourceRoot":""}